function export_pink_video()
%% 1. 配置区域 (粉红浪漫 + 视频设置)
video_filename = 'Merry Christmas.mp4'; % 导出的视频文件名
% --- Pink Romance 配色 ---
% --- Pink Romance 配色 ---
cfg.bg_col = hex2rgb('#050510');
cfg.tree_cols = hex2rgb({'#4682B4', '#1E90FF', '#87CEEB'}); 
cfg.trunk_col = hex2rgb('#2F4F4F'); 
cfg.decor_cols = hex2rgb({'#FFFFFF', '#E0FFFF', '#F0F8FF'}); 
cfg.star_col = hex2rgb('#FFD700'); % 金色星星
cfg.text_col = hex2rgb('#E0FFFF'); 
cfg.snow_col = hex2rgb('#FFFFFF');
cfg.ribbon_col = hex2rgb('#F0FFFF'); 
cfg.ribbon = true;
cfg.ribbon_width = 15;

%% 2. 初始化图形窗口
clc; close all;
% 设置固定大小以保证视频清晰度
f = figure('Color', cfg.bg_col, 'Name', 'Generating Video...', ...
'NumberTitle', 'off', 'Position', [100, 100, 720, 900], ... % 分辨率 720x900
'MenuBar', 'none', 'ToolBar', 'none', 'InvertHardcopy', 'off', 'Resize', 'off');
ax = axes('Parent', f, 'Color', cfg.bg_col, 'Position', [0 0 1 1]);
axis(ax, 'equal');
% 调整视野，确保上方文字不被切掉
axis(ax, [-0.8 0.8 -0.8 1.1 -0.8 0.8]); 
hold(ax, 'on');
axis(ax, 'off');
view(ax, 0, 0); 
%% 3. 生成数据
rng(2025); 
% --- 树叶 ---
n_leaves = 9000; % 稍微增加密度
h = rand(n_leaves, 1);
base_r = (1 - h);
layer_cycle = mod(h * 7, 1);
r = base_r * 0.65 .* (0.4 + 0.6 * (1 - layer_cycle).^0.7);
theta = rand(n_leaves, 1) * 2 * pi;
leaves.x = r .* cos(theta); leaves.y = h - 0.5; leaves.z = r .* sin(theta);
rand_idx = randi(size(cfg.tree_cols, 1), n_leaves, 1);
leaves.c = cfg.tree_cols(rand_idx, :);
leaves.s = (0.6 + rand(n_leaves, 1) * 1.2) * 10; 

% --- 树干 ---
n_trunk = 1000;
h_trunk = -0.7 + ( -0.45 - (-0.7)) * rand(n_trunk, 1);
r_trunk = 0.12;
theta_trunk = rand(n_trunk, 1) * 2 * pi;
trunk.x = r_trunk * cos(theta_trunk); trunk.y = h_trunk; trunk.z = r_trunk * sin(theta_trunk);
trunk.c = repmat(cfg.trunk_col, n_trunk, 1);
% --- 装饰 ---
n_decor = 700;
h_dec = rand(n_decor, 1) * 0.95;
base_r_dec = (1 - h_dec);
layer_cycle_dec = mod(h_dec * 7, 1);
r_dec = base_r_dec * 0.68 .* (0.4 + 0.6 * (1 - layer_cycle_dec).^0.7);
theta_dec = rand(n_decor, 1) * 2 * pi;
decor.x = r_dec .* cos(theta_dec); decor.y = h_dec - 0.5; decor.z = r_dec .* sin(theta_dec);
rand_idx_dec = randi(size(cfg.decor_cols, 1), n_decor, 1);
decor.c = cfg.decor_cols(rand_idx_dec, :);
decor.s = (2 + rand(n_decor, 1) * 2) * 15; 

% --- 丝带 ---
n_rib = 6000;
h_rib = linspace(0, 0.95, n_rib)';
base_r_rib = (1 - h_rib) * 0.65 * 1.05;
theta_rib = 10 * pi * h_rib;
ribbon.x = base_r_rib .* cos(theta_rib); ribbon.y = h_rib - 0.5; ribbon.z = base_r_rib .* sin(theta_rib);
ribbon.c = repmat(cfg.ribbon_col, n_rib, 1);

% --- 雪花 ---
n_flakes = 350; 
snow.x = (rand(n_flakes, 1) - 0.5) * 2;
snow.y = (rand(n_flakes, 1) * 2) - 0.8;
snow.z = (rand(n_flakes, 1) - 0.5) * 2;
snow.speed = 0.015 + rand(n_flakes, 1) * 0.02; 
snow.c = repmat(cfg.snow_col, n_flakes, 1);

% --- 星星 ---
star_r = 0.08; 
star_angles = linspace(pi/2, 2.5*pi, 11);
star_radii = zeros(1, 11);
star_radii(1:2:end) = star_r; star_radii(2:2:end) = star_r * 0.4;
star_x = star_radii .* cos(star_angles);
star_y = star_radii .* sin(star_angles) + 0.55; 
star_z = zeros(size(star_x)); 

%% 4. 绘制静态场景
hTrunk = scatter3(trunk.x, trunk.y, trunk.z, 20, trunk.c, 'filled');
hLeaves = scatter3(leaves.x, leaves.y, leaves.z, leaves.s, leaves.c, 'filled', ...
'MarkerFaceAlpha', 0.95, 'MarkerEdgeColor', 'none');
hRibbon = scatter3(ribbon.x, ribbon.y, ribbon.z, cfg.ribbon_width, ribbon.c, 'filled');
hDecor = scatter3(decor.x, decor.y, decor.z, decor.s, decor.c, 'filled', ...
'MarkerEdgeColor', 'w');
hSnow = scatter3(snow.x, snow.y, snow.z, 10, snow.c, 'filled', ...
'MarkerFaceAlpha', 0.8);
patch(star_x, star_y, star_z, cfg.star_col, 'EdgeColor', [1 0.8 0], 'LineWidth', 1);

% --- 文字区域 (修改点) ---
% 统一字号为 20
text_size = 20;
text(0, 0.85, 0, 'XX', 'HorizontalAlignment', 'center', ...
'Color', cfg.text_col, 'FontSize', text_size, 'FontName', 'Microsoft YaHei', 'FontWeight', 'bold');
text(0, 0.75, 0, 'Merry Christmas', 'HorizontalAlignment', 'center', ...
'Color', cfg.text_col, 'FontSize', text_size, 'FontName', 'Microsoft YaHei', 'FontWeight', 'bold');
camproj('perspective'); 
campos([0 0 3.5]); 
camtarget([0 0 0]);

% 5. 视频录制
disp(['正在录制视频: ', video_filename]);
disp('请不要最小化或遮挡图形窗口...');
%创建视频写入对象
v = VideoWriter(video_filename, 'MPEG-4');
v.FrameRate = 30; % 30帧每秒，流畅
v.Quality = 95; % 高画质
open(v);
% 动画参数
total_seconds = 12; % 视频时长12秒 (转得慢一点)
total_frames = 30 * total_seconds; 
angle_step = 2 * pi / total_frames; 
tree_parts = {hTrunk, hLeaves, hRibbon, hDecor};
orig_data = struct('x', {}, 'z', {});
for i = 1:length(tree_parts)
orig_data(i).x = tree_parts{i}.XData;
orig_data(i).z = tree_parts{i}.ZData;
end
current_angle = 0;
for i = 1:total_frames
% 1. 更新旋转
current_angle = current_angle + angle_step;
cos_a = cos(current_angle);
sin_a = sin(current_angle);
for k = 1:length(tree_parts)
new_x = orig_data(k).x * cos_a - orig_data(k).z * sin_a;
new_z = orig_data(k).z * cos_a + orig_data(k).x * sin_a;
tree_parts{k}.XData = new_x;
tree_parts{k}.ZData = new_z;
end
% 2. 更新雪花
current_snow_y = hSnow.YData;
current_snow_y = current_snow_y - snow.speed'; 
reset_indices = current_snow_y < -0.8;
current_snow_y(reset_indices) = 1.2; 
hSnow.YData = current_snow_y;
% 3. 捕捉帧并写入视频
drawnow;
frame = getframe(f); 
writeVideo(v, frame);
% 进度提示
if mod(i, 30) == 0
fprintf('进度: %.1f%%\n', (i/total_frames)*100);
end
end
close(v);
disp(['视频录制完成！已保存为: ', video_filename]);
end

%% 辅助函数
function rgb = hex2rgb(hexStr)
if iscell(hexStr)
rgb = zeros(length(hexStr), 3);
for i = 1:length(hexStr)
rgb(i, :) = hex2rgb_single(hexStr{i});
end
else
rgb = hex2rgb_single(hexStr);
end
end

function rgb = hex2rgb_single(hexStr)
if startsWith(hexStr, '#')
hexStr = hexStr(2:end);
end
if length(hexStr) == 6
r = sscanf(hexStr(1:2), '%x') / 255;
g = sscanf(hexStr(3:4), '%x') / 255;
b = sscanf(hexStr(5:6), '%x') / 255;
rgb = [r, g, b];
else
rgb = [0 0 0];
end
end
